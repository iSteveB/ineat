generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Budget {
  id          String    @id
  userId      String
  amount      Float
  periodStart DateTime
  periodEnd   DateTime
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  User        User      @relation(fields: [userId], references: [id])
  Expense     Expense[]

  @@index([periodStart, periodEnd])
  @@index([userId])
}

model Category {
  id             String     @id
  name           String
  parentId       String?
  icon           String?
  slug           String     @unique
  Category       Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  other_Category Category[] @relation("CategoryToCategory")
  Product        Product[]
}

model Expense {
  id        String   @id
  userId    String
  budgetId  String
  amount    Float
  date      DateTime
  source    String?
  receiptId String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  category  String?
  Budget    Budget   @relation(fields: [budgetId], references: [id])
  User      User     @relation(fields: [userId], references: [id])

  @@index([budgetId])
  @@index([category])
  @@index([date])
  @@index([userId])
}

model InventoryItem {
  id              String    @id
  userId          String
  productId       String
  quantity        Float
  expiryDate      DateTime?
  purchaseDate    DateTime
  purchasePrice   Float?
  storageLocation String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  notes           String?
  Product         Product   @relation(fields: [productId], references: [id])
  User            User      @relation(fields: [userId], references: [id])

  @@index([expiryDate])
  @@index([productId])
  @@index([userId])
}

model Notification {
  id            String           @id
  userId        String
  type          NotificationType
  title         String
  message       String
  isRead        Boolean          @default(false)
  referenceId   String?
  referenceType String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime
  User          User             @relation(fields: [userId], references: [id])

  @@index([isRead])
  @@index([type])
  @@index([userId])
}

model Product {
  id               String             @id
  barcode          String?            @unique
  name             String
  brand            String?
  categoryId       String
  nutriscore       NutriScore?
  ecoscore         Ecoscore?
  novascore        Novascore?
  unitType         UnitType
  nutrients        Json?
  imageUrl         String?
  externalId       String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  ingredients      String?
  InventoryItem    InventoryItem[]
  Category         Category           @relation(fields: [categoryId], references: [id])
  ReceiptItem      ReceiptItem[]
  RecipeIngredient RecipeIngredient[]

  @@index([brand])
  @@index([name])
}

model Receipt {
  id               String        @id
  userId           String
  documentType     DocumentType  @default(RECEIPT_IMAGE)
  imageUrl         String?
  pdfUrl           String?
  status           ReceiptStatus @default(PROCESSING)
  rawOcrData       Json?
  merchantName     String?
  totalAmount      Float?
  purchaseDate     DateTime?
  invoiceNumber    String?
  orderNumber      String?
  ocrProvider      String?
  ocrConfidence    Float?
  processingTime   Int?
  errorMessage     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  merchantAddress  String?
  merchantLocation String?
  User             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  ReceiptItem      ReceiptItem[]

  @@index([createdAt])
  @@index([documentType])
  @@index([purchaseDate])
  @@index([status])
  @@index([userId])
}

model ReceiptItem {
  id              String    @id
  receiptId       String
  productId       String?
  detectedName    String
  quantity        Int       @default(1)
  unitPrice       Float?
  totalPrice      Float?
  confidence      Float
  validated       Boolean   @default(false)
  productCode     String?
  category        String?
  discount        Float?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  expiryDate      DateTime?
  notes           String?
  storageLocation String?
  selectedEan     String?
  suggestedEans   Json      @default("[]")
  Product         Product?  @relation(fields: [productId], references: [id])
  Receipt         Receipt   @relation(fields: [receiptId], references: [id], onDelete: Cascade)

  @@index([productCode])
  @@index([productId])
  @@index([receiptId])
  @@index([validated])
}

model Recipe {
  id               String             @id
  name             String
  description      String?
  instructions     String
  preparationTime  Int?
  cookingTime      Int?
  servings         Int
  difficulty       RecipeDifficulty
  imageUrl         String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  RecipeIngredient RecipeIngredient[]
}

model RecipeIngredient {
  id        String  @id
  recipeId  String
  productId String
  quantity  Float
  unit      String
  notes     String?
  Product   Product @relation(fields: [productId], references: [id])
  Recipe    Recipe  @relation(fields: [recipeId], references: [id])

  @@index([productId])
  @@index([recipeId])
}

model User {
  id            String          @id
  email         String          @unique
  passwordHash  String
  firstName     String
  lastName      String
  profileType   ProfileType
  preferences   Json
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  subscription  Subscription    @default(FREE)
  avatarUrl     String?
  Budget        Budget[]
  Expense       Expense[]
  InventoryItem InventoryItem[]
  Notification  Notification[]
  Receipt       Receipt[]
}

enum DocumentType {
  RECEIPT_IMAGE
  INVOICE_PDF
  INVOICE_HTML
}

enum Ecoscore {
  A
  B
  C
  D
  E
}

enum NotificationType {
  EXPIRY
  BUDGET
  SYSTEM
}

enum Novascore {
  GROUP_1
  GROUP_2
  GROUP_3
  GROUP_4
}

enum NutriScore {
  A
  B
  C
  D
  E
}

enum ProfileType {
  FAMILY
  STUDENT
  SINGLE
}

enum ReceiptStatus {
  PROCESSING
  COMPLETED
  FAILED
  VALIDATED
}

enum RecipeDifficulty {
  EASY
  MEDIUM
  HARD
}

enum Subscription {
  FREE
  PREMIUM
  ADMIN
}

enum UnitType {
  KG
  G
  L
  ML
  UNIT
}
