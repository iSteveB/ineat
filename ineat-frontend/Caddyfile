# Configuration globale
{
    admin off
    persist_config off
    auto_https off
    log {
        format json
    }
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8
    }
}

# Bloc serveur
:{$PORT:3000} {
    log {
        format json
    }
    
    # Health check pour Railway
    rewrite /health /*
    
    # Servir depuis le dossier de build (dist pour Vite, build pour CRA)
    root * dist
    
    # Compression gzip
    encode gzip
    
    # Servir les fichiers statiques
    file_server
    
    # SOLUTION CLÃ‰E : Redirection pour le routage SPA
    try_files {path} /index.html
}